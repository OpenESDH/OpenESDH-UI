<md-toolbar id="global-toolbar" class="global-tools">

    <div class="global-tools__links">
        <img class="md-toolbar-tools__logo" src="./app/assets/images/logo-light.svg" alt="">
        <a class="md-button global-tools__link" ui-sref="dashboard"><i class="material-icons">dashboard</i> <span hide show-gt-md>{{ 'COMMON.HOME' | translate }}</span></a>
        <a class="md-button global-tools__link" ui-sref="cases"><i class="material-icons">folder_open</i> <span hide show-gt-md>{{ 'CASE.CASES' | translate }}</span></a>
        <a class="md-button global-tools__link" ui-sref="tasks"><i class="material-icons">assignment</i> <span hide show-gt-md>{{ 'TASK.TASKS' | translate }}</span></a>
        <a class="md-button global-tools__link" ui-sref="templates"><i class="material-icons">library_books</i> {{ 'DOCUMENT.TEMPLATE.LABELS.TEMPLATES' | translate }}</a>
    </div>
    
    <md-menu ng-controller="AuthController as vm"
             class="global-tools__user"
             md-position-mode="target-right target">
        <md-button aria-label="{{ 'MENU.OPEN_MENU' | translate }}" ng-click="$mdOpenMenu($event)"
                   style="text-transform: capitalize;">
            <span hide-sm>{{ vm.getUserInfo().user.firstName }}</span> <span hide-sm hide-md>{{ vm.getUserInfo().user.lastName }}</span>
            <i class="material-icons" style="vertical-align: middle;">more_vert</i>
        </md-button>
        <md-menu-content width="4">
            <md-menu-item hide-gt-md class="logged-in-user">
                <i class="material-icons" style="vertical-align: middle; width: auto; padding-left: 0;">person</i>
                {{ vm.getUserInfo().user.firstName }} {{ vm.getUserInfo().user.lastName }}
            </md-menu-item>
            <md-menu-divider hide-gt-md></md-menu-divider>
            <md-menu-item>
                <md-button ng-disabled="true">
                    {{ 'MENU.VIEW_PROFILE' | translate }}
                </md-button>
            </md-menu-item>
            <md-menu-item ng-show="vm.getUserInfo().user.capabilities.isAdmin">
                <md-button ui-sref="administration.users">
                    {{ 'ADMIN.ADMINISTRATION' | translate }}
                </md-button>
            </md-menu-item>
            <md-menu-divider></md-menu-divider>
            <md-menu-item>
                <md-button ng-click="vm.logout()">
                    {{ 'MENU.LOGOUT' | translate }}
                </md-button>
            </md-menu-item>
        </md-menu-content>
    </md-menu>

    <div id="global-search"
         ng-controller="AutosuggestController as asctrl"
         class="global-tools__search">
        <form ng-submit="asctrl.gotoSearchPage()">
            <md-input-container md-no-float>
                <i class="material-icons">search</i>
                <input type="text" ng-model="asctrl.searchTerm"
                       ng-change="asctrl.getLiveSearchResults(asctrl.searchTerm)"
                       ng-keydown="asctrl.keydown($event)" ng-model-options="{ debounce: 250 }"
                       placeholder="{{ 'SEARCH.SEARCH' | translate }}">
            </md-input-container>

            <!-- Autocomplete dropdown -->
            <md-whiteframe class="md-whiteframe-z2" ng-if="asctrl.suggestionVisible()">
                <md-list>
                    <md-subheader class="md-no-sticky" ng-if="asctrl.liveSearchResults.documents.length">
                        {{ 'DOCUMENT.DOCUMENTS' | translate}}
                    </md-subheader>
                    <md-list-item class="md-2-line" ng-if="asctrl.liveSearchResults.documents.length"
                                  ng-repeat="item in asctrl.liveSearchResults.documents"
                                  ng-mousedown="asctrl.goToSuggestion(item)"
                                  ng-class="{'activeSuggestion' : asctrl.selectedIndex == $index}">
                        <img class="md-avatar" ng-src="/app/assets/images/filetypes/{{item.thumbNailURL}}"/>

                        <div class="md-list-item-text" layout="column">
                            <h3 ng-bind="item.title"></h3>

                            <!--TODO For some reason translate filter won't pick this up-->
                            <!--<p><b>{{ "CASE.CASE" | translate}}:</b> {{ item.case.caseTitle }}</p>-->
                            <p><b>Sag:</b> {{ item.case.caseTitle }}</p>
                        </div>
                    </md-list-item>

                    <md-divider ng-if="asctrl.liveSearchResults.documents.length > 0 && asctrl.liveSearchResults.cases.length > 0"></md-divider>

                    <md-subheader class="md-no-sticky" ng-if="asctrl.liveSearchResults.cases.length">
                        {{ 'CASE.CASES' | translate}}
                    </md-subheader>
                    <md-list-item class="md-2-line" ng-if="asctrl.liveSearchResults.cases.length"
                                  ng-repeat="item in asctrl.liveSearchResults.cases" ng-mousedown="asctrl.goToSuggestion(item)"
                                  ng-class="{'activeSuggestion' : asctrl.selectedIndex == $index + asctrl.liveSearchResults.documents.length}">
                        <md-icon class="material-icons">folder_open</md-icon>

                        <div class="md-list-item-text">
                            <h3 ng-bind-template="{{item.caseTitle}} ({{item.caseId}}) "></h3>

                            <p ng-bind="item.caseDescription"></p>

                        </div>
                    </md-list-item>

                    <md-list-item class="md-2-line" ng-show="asctrl.liveSearchResults.documents.length == 0 && asctrl.liveSearchResults.cases.length == 0">
                        <div class="md-list-item-text">
                            <p ng-bind="'SEARCH.NO_MATCHES' | translate"></p>
                        </div>
                    </md-list-item>

                    <md-list-item layout-align="center center" ng-if="asctrl.loading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </md-list-item>
                </md-list>

            </md-whiteframe>
        </form>
    </div>

</md-toolbar>
