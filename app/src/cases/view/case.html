<app-header></app-header>

<md-content layout="column">
  
  
    <div class="sub-toolbar">
    
        <div layout="row" layout-align="space-between center" layout-padding>
    
            <div layout="row" layout-align="start center">
                <md-button ng-href="#/cases" ng-aria="{{ 'CASE.CASES' | translate }}">
                    <i class="material-icons" style="vertical-align: middle;">arrow_back</i>
                </md-button>
                <h1 class="md-headline" layout-margin>
                    {{ case["cm:title"].value }} <span class="muted">{{ case["oe:id"].value }}</span>
                    <span class="muted" ng-hide="case['oe:status'].value === 'active'">
                        ({{case['oe:status'].value | caseStatus}})
                    </span>
                </h1>
            </div>
      
            <md-menu>
                <md-button class="md-primary" ng-click="$mdOpenMenu($event)"
                           aria-label="{{ 'CASE.CHANGE_STATUS' | translate }}"
                           ng-disabled="caseStatusChoices.length == 0">
                    {{ 'CASE.CHANGE_STATUS' | translate }}
                </md-button>
                    <md-menu-content>
                        <md-menu-item ng-repeat="choiceName in caseStatusChoices">
                        <md-button ng-class="{'current-choice': choiceName === case['oe:status'].value}"
                                   ng-disabled="choiceName === case['oe:status'].value"
                                   aria-label="{{ choiceName | caseStatus }}"
                                   ng-click="vm.changeCaseStatus(choiceName)">
                            {{ choiceName | caseStatus }}
                        </md-button>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
      
        </div>
    
    </div>
  
  <md-tabs md-dynamic-height>
    
    <md-tab md-on-select="vm.onTabChange('case')">
      <md-tab-label>
        <span><i class="material-icons">folder_open</i> {{ 'CASE.CASE' | translate }}</span>
      </md-tab-label>
      <md-tab-body>
        
        <div layout="row" layout-wrap>
          
          <div flex="100" flex-gt-md="25">
            <md-card>
              <md-card-content>
                <h3 class="md-title">{{ 'COMMON.INFORMATION' | translate }}</h3>
                <dl layout="row" layout-wrap>
                  <dt flex="33">{{ 'COMMON.ID' | translate }}</dt><dd flex="66">{{ case["oe:id"].value }}</dd>
                  <dt flex="33">{{ 'COMMON.TITLE' | translate }}</dt><dd flex="66">{{ case["cm:title"].value }}</dd>
                  <dt flex="33">{{ 'COMMON.STATUS' | translate }}</dt><dd flex="66">{{ case["oe:status"].value | caseStatus }}</dd>
                  <dt flex="33">{{ 'COMMON.CREATEDBY' | translate }}</dt><dd flex="66">{{ case["cm:creator"].fullname }}</dd>
                  <dt flex="33">{{ 'COMMON.CREATED' | translate }}</dt><dd flex="66">{{ case["cm:created"].value | openeDate}}</dd>
                  <dt flex="33">{{ 'CASE.CASE_OWNER' | translate }}</dt><dd flex="66">{{ case["base:owners"].fullname }}</dd>
                  <dt flex="33">{{ 'COMMON.MODIFIED' | translate }}</dt><dd flex="66">{{ case["cm:modified"].value  | openeDate}}</dd>
                  <dt flex="33">{{ 'CASE.JOURNAL_KEY' | translate }}</dt><dd flex="66">{{ case["oe:journalKey"].displayValue }}</dd>
                  <dt flex="33" ng-hide="case['oe:journalFacet'] | isEmpty">{{ 'CASE.JOURNAL_FACET' | translate}}</dt>
                  <dd flex="66" ng-hide="case['oe:journalFacet'] | isEmpty">{{ case["oe:journalFacet"].displayValue }}</dd>
                  <dt flex="33">{{ 'COMMON.DESCRIPTION' | translate }}</dt><dd flex="66">{{ case["cm:description"].value }}</dd>
                </dl>
              </md-card-content>
              <div class="md-actions" layout="column" layout-padding layout-align="start start">
                <md-button class="md-primary" ng-click="vm.editCase($event)"
                           ng-disabled="caseIsLocked">{{ 'CASE.EDIT_INFORMATION' | translate }}</md-button>
                <md-button class="md-primary" ng-disabled="true">{{ 'CASE.PRINT_CASE' | translate }}</md-button>
                <md-button class="md-primary" ng-click="vm.startWorklfow()">{{ 'CASE.START_WORKFLOW' | translate }}</md-button>
              </div>
            </md-card>
          </div>
          
          <div flex="100" flex-gt-md="75">
            <md-card ng-controller="DocumentController as docCtrl">
              <md-card-content>
                <h3 class="md-title">{{ 'DOCUMENT.DOCUMENTS' | translate }}</h3>
                
                <div class="repeat-table">
                    <div class="repeat-header" layout="row">
                        <span class="r" flex="5"></span>
                        <span class="r" flex>{{ 'COMMON.TITLE' | translate }}</span>
                        <span class="r" flex>{{ 'COMMON.TYPE' | translate }}</span>
                        <span class="r" flex>{{ 'COMMON.CATEGORY' | translate }}</span>
                        <span class="r" flex>{{ 'COMMON.CREATEDBY' | translate }}</span>
                        <span class="r" flex>{{ 'COMMON.CREATED' | translate }}</span>
                        <span class="r" flex>{{ 'COMMON.MODIFIED' | translate }}</span>
                        <span flex="10"></span>
                    </div>
                    <md-virtual-repeat-container md-auto-shrink>
                        <div md-virtual-repeat="doc in docCtrl.documents" class="repeat-item" layout="row">
                            <a class="r-rowlink" href="#/cases/case/{{docCtrl.caseId}}/doc/{{doc.nodeRef | nodeRefUri}}" layout="row" flex="90">
                                <span class="r" flex="5"><img class="md-avatar" ng-src="/app/assets/images/filetypes/{{doc.thumbNailURL}}"/></span>
                                <span class="r" flex>{{ doc["cm:title"] }}</span>
                                <span class="r muted" flex>{{ doc["doc:type"] }}</span>
                                <span class="r muted" flex>{{ doc["doc:category"] }}</span>
                                <span class="r muted" flex>
                                    <span ng-repeat="owner in doc['doc:owner']">{{owner.fullname}}</span>
                                </span>
                                <span class="r muted" flex>{{ doc["cm:created"] | openeDate }}</span>
                                <span class="r muted" flex>{{ doc["cm:modified"] | openeDate }}</span>
                            </a>
                            <span flex="10">
                                <md-button class="md-primary" ng-click="docCtrl.previewDocument(doc.mainDocNodeRef)">{{ 'COMMON.PREVIEW' | translate }}</md-button>
                            </span>
                            <span flex="10">
                                <md-button class="md-primary" ng-click="docCtrl.deleteDocument(doc)" ng-show="docCtrl.isAdmin">{{ 'COMMON.DELETE' | translate }}</md-button>
                            </span>
                        </div>
                    </md-virtual-repeat-container>
                </div>
                
              </md-card-content>
              <div class="md-actions" layout="row" layout-padding>
                <md-button class="md-primary"
                           ng-click="docCtrl.uploadDocument()"
                           ng-disabled="caseIsLocked">
                  <i class="material-icons">file_upload</i>
                  {{ 'DOCUMENT.UPLOAD_NEW_DOCUMENTS' | translate }}
                </md-button>
                <md-menu>
                  <md-button ng-click="$mdOpenMenu($event)" class="md-primary" aria-label="{{ 'DOCUMENT.SEND_DOCUMENTS' | translate }}">
                    {{ 'DOCUMENT.SEND_DOCUMENTS' | translate }}
                  </md-button>
                  <md-menu-content>
                    <md-menu-item>
                      <md-button ng-disabled="docCtrl.noDocuments()" ng-click="docCtrl.emailDocuments()">{{ 'DOCUMENT.EMAIL_DOCUMENTS' | translate }}</md-button>
                    </md-menu-item>
                    <md-menu-item>
                      <md-button ng-disabled="true" ng-click="doSomething()">{{ 'DOCUMENT.DIGITAL_POST_DOCUMENTS' | translate }}</md-button>
                    </md-menu-item>
                  </md-menu-content>
                </md-menu>
                <md-button class="md-primary"
                           ng-click="docCtrl.createDocumentFromTemplate()">
                  {{ 'DOCUMENT.CREATE_FROM_TEMPLATE' | translate }}
                </md-button>
              </div>
            </md-card>
          </div>
          
        </div>
        
      </md-tab-body>
    </md-tab>
    
    <md-tab>
      <md-tab-label>
        <span><i class="material-icons">library_books</i> {{ 'NOTE.NOTES' | translate }}</span>
      </md-tab-label>
      <md-tab-body layout="column">
        <md-card ng-controller="NoteController as caseNotes">
          <md-card-content>
            <h3 class="md-title">{{ 'NOTE.NOTES' | translate }}</h3>
            <div layout="row" layout-wrap>
                <div ng-repeat="note in caseNotes.notes" flex="33">
                    <h4 style="margin-bottom: 0;" class="md-title">{{ note.headline }}</h4>
                    <p>{{ note.content }}</p>
                    <p style="font-size: 0.8em;" class="muted">
                      {{ 'COMMON.CREATED' | translate }} {{ note.created | openeDate }} {{ 'COMMON.BY' | translate }} {{ note.authorInfo.firstName + ' ' + note.authorInfo.lastName }}<br>
                      {{ 'NOTE.RELATED' | translate }}: <span style="margin-right: 0.5em;" ng-repeat="relation in note.concernedPartiesInfo">{{ relation.name }}</span>
                    </p>
                </div>                
            </div>
          </md-card-content>
          <div class="md-actions" layout="row">
            <md-button class="md-primary" ng-click="caseNotes.newNote()"
                       ng-disabled="caseIsLocked">{{ 'NOTE.NEW_NOTE' | translate }}</md-button>
            <md-button class="md-primary" ng-disabled="true">{{ 'NOTE.PRINT_ALL_NOTES' | translate }}</md-button>
          </div>
        </md-card>
      </md-tab-body>
    </md-tab>
    
    <md-tab md-on-select="vm.onTabChange('members')">
      <md-tab-label>
        <span><i class="material-icons">people</i> {{ 'MEMBER.MEMBERS' | translate }}</span>
      </md-tab-label>
      <md-tab-body layout="column">
        <div ng-include="'app/src/case_members/view/caseMembers.html'"></div>
      </md-tab-body>
    </md-tab>
    
    <md-tab md-on-select="vm.onTabChange('parties')">
      <md-tab-label>
        <span><i class="material-icons">people_outline</i> {{ 'PARTY.PARTIES'| translate }}</span>
      </md-tab-label>
      <md-tab-body layout="column">
        <div ng-include="'app/src/parties/view/caseParties.html'"></div>
      </md-tab-body>
    </md-tab>
      
    <md-tab md-on-select="vm.onTabChange('history')">
      <md-tab-label>
        <span><i class="material-icons">history</i> {{ 'COMMON.HISTORY' | translate }}</span>
      </md-tab-label>
      <md-tab-body layout="column">
        <md-card ng-controller="CaseHistoryController as historyCtrl">
          <md-card-content>
            <h3>{{ 'CASE.CASE_HISTORY' | translate }}</h3>
            <table>
              <thead>
                <tr>
                  <th>{{ 'COMMON.ACTION' | translate }}</th>
                  <th>{{ 'COMMON.TYPE' | translate }}</th>
                  <th>{{ 'USER.USER' | translate }}</th>
                  <th>{{ 'COMMON.TIME' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="log in historyCtrl.history">
                  <td>{{ log.action }}</td>
                  <td>{{ log.type }}</td>
                  <td>{{ log.user }}</td>
                  <td>{{ log.time | openeDate: 'fullDate'}}</td>
                </tr>
              </tbody>
            </table>
          </md-card-content>
          <div class="md-actions">
              <div style="float: right;">
                  <span>{{historyCtrl.startIndex}} - {{historyCtrl.endIndex}} {{ 'COMMON.OF' | translate }} {{historyCtrl.totalItems}}</span>
                  <span>
                      <md-button ng-click="historyCtrl.loadPreviousPage()" ng-disabled="!historyCtrl.previousPage">&lt;</md-button>
                      <md-button ng-click="historyCtrl.loadNextPage()" ng-disabled="!historyCtrl.nextPage">&gt;</md-button>
                  </span>
              </div>
          </div>
        </md-card>
      </md-tab-body>
    </md-tab>
    
  </md-tabs>

</md-content>

<app-footer></app-footer>
